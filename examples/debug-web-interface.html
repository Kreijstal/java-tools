<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JVM Debug API Example</title>
    <!-- Include Ace Editor from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.15.2/ace.js"></script>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e1e1e;
            color: #d4d4d4;
        }
        
        .main-container { 
            display: grid; 
            grid-template-columns: 2fr 1fr; 
            gap: 20px; 
            margin-top: 20px;
        }
        
        .debugger-panel { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        
        .state-panel-stack { 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
        }
        
        .panel {
            background-color: #252526;
            border: 1px solid #3e3e42;
            padding: 15px;
            border-radius: 5px;
        }
        
        .panel h3 {
            margin-top: 0;
            color: #569cd6;
        }
        
        .controls {
            grid-column: 1 / -1;
        }
        
        #disassembly-editor { 
            width: 100%; 
            height: 60vh; 
            border: 1px solid #3e3e42; 
            border-radius: 5px; 
        }
        
        .debug-controls { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 10px; 
            flex-wrap: wrap;
            align-items: center;
        }
        
        .debug-controls button { 
            font-size: 1.2em; 
            padding: 8px 12px; 
            min-width: 40px;
            background-color: #0e639c;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .debug-controls button:hover {
            background-color: #1177bb;
        }
        
        .debug-controls button:disabled {
            background-color: #3e3e42;
            cursor: not-allowed;
        }
        
        .ace_gutter-cell.ace_breakpoint { 
            background-color: #f44336 !important; 
            border-radius: 50%; 
        }
        
        .ace-editor-highlight { 
            position: absolute; 
            background: rgba(86, 156, 214, 0.3); 
            z-index: 20; 
        }
        
        .state-display {
            background-color: #1e1e1e;
            border: 1px solid #3e3e42;
            padding: 10px;
            border-radius: 3px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .output {
            background-color: #1e1e1e;
            border: 1px solid #3e3e42;
            padding: 10px;
            border-radius: 3px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .status {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 3px;
            border-left: 4px solid #007acc;
            background-color: #0f4a85;
        }
        
        .error {
            color: #f44747;
            background-color: #5a1d1d;
            border-left-color: #f44747;
        }
        
        .success {
            color: #4ec9b0;
            background-color: #1e3a32;
            border-left-color: #4ec9b0;
        }
        
        button {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }
        
        button:hover {
            background-color: #1177bb;
        }
        
        button:disabled {
            background-color: #3e3e42;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üîç JVM Debug API Example</h1>
    <p>This example demonstrates how to use the JVM debug API from JavaScript/Web applications.</p>
    
    <div class="panel controls">
        <h3>File Operations</h3>
        <div id="status" class="status">Ready - No program loaded</div>
    </div>

    <!-- Main UI Layout with IDE-style interface -->
    <div class="main-container">
        <!-- Left Column: Debugger -->
        <div class="debugger-panel panel">
            <div class="debug-controls">
                <button onclick="continue_()" title="Continue (F8)">‚ñ∂Ô∏è</button>
                <button onclick="stepOver()" title="Step Over (F10)">‚Ü∑</button>
                <button onclick="stepInto()" title="Step Into (F11)">‚Ü™Ô∏è</button>
                <button onclick="stepOut()" title="Step Out (Shift+F11)">‚Ü©Ô∏è</button>
                <button onclick="finish()" title="Finish Method">‚è©</button>
                <button onclick="serializeState()" title="Serialize State">üíæ</button>
                <button onclick="document.getElementById('stateFileInput').click()" title="Restore State">üìÇ</button>
                <input type="file" id="stateFileInput" style="display: none;" accept=".json">
            </div>
            <div id="disassembly-editor"></div>
        </div>

        <!-- Right Column: State & Output -->
        <div class="state-panel-stack">
            <div class="panel">
                <h3>Execution State</h3>
                <div id="executionState" class="state-display">Not started</div>
            </div>
            <div class="panel">
                <h3>Stack</h3>
                <div id="stackDisplay" class="state-display">Empty</div>
            </div>
            <div class="panel">
                <h3>Locals</h3>
                <div id="localsDisplay" class="state-display">No locals</div>
            </div>
            <div class="panel">
                <h3>Output Console</h3>
                <div id="output" class="output"></div>
            </div>
        </div>
    </div>
    
    <div class="panel">
        <h3>Usage Instructions</h3>
        <div style="font-size: 12px; line-height: 1.5;">
            <p><strong>Note:</strong> This is a frontend demonstration. In a real application, the JVM debug controller would run on the Node.js backend, and you'd communicate with it via HTTP/WebSocket APIs.</p>
            
            <p><strong>Debug Commands:</strong></p>
            <ul>
                <li><strong>‚ñ∂Ô∏è Continue:</strong> Run until next breakpoint or completion</li>
                <li><strong>‚Ü∑ Step Over:</strong> Execute next instruction, skipping over method calls</li>
                <li><strong>‚Ü™Ô∏è Step Into:</strong> Execute next instruction, entering method calls</li>
                <li><strong>‚Ü©Ô∏è Step Out:</strong> Continue until current method returns</li>
                <li><strong>‚è© Finish Method:</strong> Run until current method completes</li>
            </ul>
            
            <p><strong>State Management:</strong></p>
            <ul>
                <li><strong>üíæ Serialize State:</strong> Download complete JVM state as JSON file</li>
                <li><strong>üìÇ Restore State:</strong> Upload and reload previously serialized state</li>
                <li><strong>Breakpoints:</strong> Click in the disassembly gutter to toggle breakpoints</li>
            </ul>
            
            <p><strong>Disassembly View:</strong></p>
            <ul>
                <li>Interactive code editor showing bytecode disassembly</li>
                <li>Current instruction highlighted automatically</li>
                <li>Click gutter (line numbers area) to set/remove breakpoints</li>
                <li>Red dots indicate active breakpoints</li>
            </ul>
        </div>
    </div>

    <script>
        // Mock implementation for demonstration
        let aceEditor = null;
        let currentState = {
            status: 'stopped',
            pc: null,
            stack: [],
            locals: [],
            callDepth: 0,
            method: null,
            breakpoints: []
        };
        
        function initializeEditor() {
            aceEditor = ace.edit("disassembly-editor");
            aceEditor.setTheme("ace/theme/monokai");
            aceEditor.session.setMode("ace/mode/text");
            aceEditor.setReadOnly(true);
            aceEditor.renderer.setShowGutter(true);
            aceEditor.renderer.setPadding(10);
            aceEditor.setOptions({ 
                highlightActiveLine: false, 
                highlightGutterLine: false,
                fontSize: 12
            });

            aceEditor.setValue('Load a class to see disassembly...', -1);
        }
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += \`<div class="\${className}">[\${timestamp}] \${message}</div>\`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
        }
        
        // Mock debug functions
        function continue_() { log('Mock: Continue execution', 'info'); }
        function stepOver() { log('Mock: Step over', 'info'); }
        function stepInto() { log('Mock: Step into', 'info'); }
        function stepOut() { log('Mock: Step out', 'info'); }
        function finish() { log('Mock: Finish method', 'info'); }
        function serializeState() { log('Mock: Serialize state', 'info'); }
        
        // Initialize editor when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeEditor();
            log('JVM Debug API Example loaded (mock implementation)', 'info');
        });
    </script>
</body>
</html>